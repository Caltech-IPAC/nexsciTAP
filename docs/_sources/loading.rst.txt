
Adding Spatial Indexing to Your Data
====================================

Do I Need a Spatial Index
-------------------------

The TAP service will operate without spatialindexing, but your queries cannot include CONTAINS() constraints. We recommend adding the spatial constraints for all but the smallest tables. You can in fact add the spatial indexing after deploying there service, but you must reload the tables.


Augmenting Your Tables to Support Spatial Indexing
--------------------------------------------------
There are four columns you will need to add ito support our built-in 
spatial indexing: x, y, z and spt_ind.  The first three are the unit sphere geometry
three-vector of the point and are calculated simply as::

   x = sin(RA) * cos(Dec)
   y = cos(RA) * cos(Dec)
   z = sin(Dec)

We recommend calculating them as full double precision numbers.

The fourth is the spatial index value itself, an integer.  

Computing Values for the Spatial Indexing Columns 
-------------------------------------------------
The SpatialIndex package will compute all of these values.  The underlying
libraries are written in C and there is an example program (SpatialIndex/src/sptIndx.c)
that adds (x,y,z) and both HTM and HPX spatial index ID columns to a CSV file.

If you are working in Python, you already have the SpatialIndex code as a dependency of nexsciTAP.  If you prefer to work in C, download the source from
(ttps://github.com/Caltech-IPAC/SpatialIndex.git from GitHub and build it (run "make").
